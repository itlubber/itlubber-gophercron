var Ct=Object.defineProperty,Vt=Object.defineProperties;var St=Object.getOwnPropertyDescriptors;var ze=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var We=(e,t,n)=>t in e?Ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ue=(e,t)=>{for(var n in t||(t={}))Ot.call(t,n)&&We(e,n,t[n]);if(ze)for(var n of ze(t))Bt.call(t,n)&&We(e,n,t[n]);return e},qe=(e,t)=>Vt(e,St(t));import{Q as Je,b as Mt,a as oe,c as Ie}from"./QTabPanels.48f77c7a.js";import{w as ee,aD as Tt,j as ne,c as M,r as T,u as we,l as D,m as P,q as E,s as x,z as N,A as rt,F as $,o as ie,cI as Dt,aw as Ke,E as ve,aI as $t,t as J,J as Pt,n as Ce,aC as Lt,k as _e,bp as Qt,Q as q,f as re,I as pe,x as he,cJ as Rt,cK as zt,cL as Wt,cM as Ut,B as qt,D as at,cN as Jt,cO as Kt}from"./index.c00bb6a6.js";import{u as lt,Q as Ht}from"./QToggle.fe3ccf7f.js";import{_ as He}from"./Confirm.2aa4f180.js";import{Q as Yt,b as it,a as le}from"./QDialog.8deced28.js";import{Q as Xt}from"./QCardActions.ca419d19.js";import{b as K,a as H,Q as Zt,c as ye}from"./QChip.5d8be3da.js";import{b as st,Q as ut}from"./QSelect.00841303.js";import{Q as Gt}from"./QList.36515eac.js";import{C as ae}from"./ClosePopup.d0d9f96f.js";import{Q as Fe}from"./QInput.b008bd08.js";import{Q as en}from"./QForm.9ae98661.js";import{Q as tn}from"./QInnerLoading.56c14084.js";import{_ as nn,Q as on}from"./JSONViewer.d9c2053f.js";import{f as Ye}from"./datetime.561112b0.js";import"./use-key-composition.d99d77ec.js";import"./focus-manager.51458ac1.js";import"./touch.8438639b.js";import"./rtl.b51694b1.js";import"./format.865294d5.js";var rn=Object.defineProperty,an=Object.defineProperties,ln=Object.getOwnPropertyDescriptors,Xe=Object.getOwnPropertySymbols,sn=Object.prototype.hasOwnProperty,un=Object.prototype.propertyIsEnumerable,Ze=(e,t,n)=>t in e?rn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,je=(e,t)=>{for(var n in t||(t={}))sn.call(t,n)&&Ze(e,n,t[n]);if(Xe)for(var n of Xe(t))un.call(t,n)&&Ze(e,n,t[n]);return e},fn=(e,t)=>an(e,ln(t));function ft(e,t){var n,o=1;e==null&&(e=0),t==null&&(t=0);function r(){var i,s=n.length,l,u=0,a=0;for(i=0;i<s;++i)l=n[i],u+=l.x,a+=l.y;for(u=(u/s-e)*o,a=(a/s-t)*o,i=0;i<s;++i)l=n[i],l.x-=u,l.y-=a}return r.initialize=function(i){n=i},r.x=function(i){return arguments.length?(e=+i,r):e},r.y=function(i){return arguments.length?(t=+i,r):t},r.strength=function(i){return arguments.length?(o=+i,r):o},r}function dn(e){const t=+this._x.call(null,e),n=+this._y.call(null,e);return dt(this.cover(t,n),t,n,e)}function dt(e,t,n,o){if(isNaN(t)||isNaN(n))return e;var r,i=e._root,s={data:o},l=e._x0,u=e._y0,a=e._x1,d=e._y1,m,w,h,b,c,f,p,g;if(!i)return e._root=s,e;for(;i.length;)if((c=t>=(m=(l+a)/2))?l=m:a=m,(f=n>=(w=(u+d)/2))?u=w:d=w,r=i,!(i=i[p=f<<1|c]))return r[p]=s,e;if(h=+e._x.call(null,i.data),b=+e._y.call(null,i.data),t===h&&n===b)return s.next=i,r?r[p]=s:e._root=s,e;do r=r?r[p]=new Array(4):e._root=new Array(4),(c=t>=(m=(l+a)/2))?l=m:a=m,(f=n>=(w=(u+d)/2))?u=w:d=w;while((p=f<<1|c)===(g=(b>=w)<<1|h>=m));return r[g]=i,r[p]=s,e}function cn(e){var t,n,o=e.length,r,i,s=new Array(o),l=new Array(o),u=1/0,a=1/0,d=-1/0,m=-1/0;for(n=0;n<o;++n)isNaN(r=+this._x.call(null,t=e[n]))||isNaN(i=+this._y.call(null,t))||(s[n]=r,l[n]=i,r<u&&(u=r),r>d&&(d=r),i<a&&(a=i),i>m&&(m=i));if(u>d||a>m)return this;for(this.cover(u,a).cover(d,m),n=0;n<o;++n)dt(this,s[n],l[n],e[n]);return this}function pn(e,t){if(isNaN(e=+e)||isNaN(t=+t))return this;var n=this._x0,o=this._y0,r=this._x1,i=this._y1;if(isNaN(n))r=(n=Math.floor(e))+1,i=(o=Math.floor(t))+1;else{for(var s=r-n||1,l=this._root,u,a;n>e||e>=r||o>t||t>=i;)switch(a=(t<o)<<1|e<n,u=new Array(4),u[a]=l,l=u,s*=2,a){case 0:r=n+s,i=o+s;break;case 1:n=r-s,i=o+s;break;case 2:r=n+s,o=i-s;break;case 3:n=r-s,o=i-s;break}this._root&&this._root.length&&(this._root=l)}return this._x0=n,this._y0=o,this._x1=r,this._y1=i,this}function vn(){var e=[];return this.visit(function(t){if(!t.length)do e.push(t.data);while(t=t.next)}),e}function hn(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function W(e,t,n,o,r){this.node=e,this.x0=t,this.y0=n,this.x1=o,this.y1=r}function gn(e,t,n){var o,r=this._x0,i=this._y0,s,l,u,a,d=this._x1,m=this._y1,w=[],h=this._root,b,c;for(h&&w.push(new W(h,r,i,d,m)),n==null?n=1/0:(r=e-n,i=t-n,d=e+n,m=t+n,n*=n);b=w.pop();)if(!(!(h=b.node)||(s=b.x0)>d||(l=b.y0)>m||(u=b.x1)<r||(a=b.y1)<i))if(h.length){var f=(s+u)/2,p=(l+a)/2;w.push(new W(h[3],f,p,u,a),new W(h[2],s,p,f,a),new W(h[1],f,l,u,p),new W(h[0],s,l,f,p)),(c=(t>=p)<<1|e>=f)&&(b=w[w.length-1],w[w.length-1]=w[w.length-1-c],w[w.length-1-c]=b)}else{var g=e-+this._x.call(null,h.data),A=t-+this._y.call(null,h.data),k=g*g+A*A;if(k<n){var j=Math.sqrt(n=k);r=e-j,i=t-j,d=e+j,m=t+j,o=h.data}}return o}function wn(e){if(isNaN(d=+this._x.call(null,e))||isNaN(m=+this._y.call(null,e)))return this;var t,n=this._root,o,r,i,s=this._x0,l=this._y0,u=this._x1,a=this._y1,d,m,w,h,b,c,f,p;if(!n)return this;if(n.length)for(;;){if((b=d>=(w=(s+u)/2))?s=w:u=w,(c=m>=(h=(l+a)/2))?l=h:a=h,t=n,!(n=n[f=c<<1|b]))return this;if(!n.length)break;(t[f+1&3]||t[f+2&3]||t[f+3&3])&&(o=t,p=f)}for(;n.data!==e;)if(r=n,!(n=n.next))return this;return(i=n.next)&&delete n.next,r?(i?r.next=i:delete r.next,this):t?(i?t[f]=i:delete t[f],(n=t[0]||t[1]||t[2]||t[3])&&n===(t[3]||t[2]||t[1]||t[0])&&!n.length&&(o?o[p]=n:this._root=n),this):(this._root=i,this)}function mn(e){for(var t=0,n=e.length;t<n;++t)this.remove(e[t]);return this}function yn(){return this._root}function kn(){var e=0;return this.visit(function(t){if(!t.length)do++e;while(t=t.next)}),e}function _n(e){var t=[],n,o=this._root,r,i,s,l,u;for(o&&t.push(new W(o,this._x0,this._y0,this._x1,this._y1));n=t.pop();)if(!e(o=n.node,i=n.x0,s=n.y0,l=n.x1,u=n.y1)&&o.length){var a=(i+l)/2,d=(s+u)/2;(r=o[3])&&t.push(new W(r,a,d,l,u)),(r=o[2])&&t.push(new W(r,i,d,a,u)),(r=o[1])&&t.push(new W(r,a,s,l,d)),(r=o[0])&&t.push(new W(r,i,s,a,d))}return this}function xn(e){var t=[],n=[],o;for(this._root&&t.push(new W(this._root,this._x0,this._y0,this._x1,this._y1));o=t.pop();){var r=o.node;if(r.length){var i,s=o.x0,l=o.y0,u=o.x1,a=o.y1,d=(s+u)/2,m=(l+a)/2;(i=r[0])&&t.push(new W(i,s,l,d,m)),(i=r[1])&&t.push(new W(i,d,l,u,m)),(i=r[2])&&t.push(new W(i,s,m,d,a)),(i=r[3])&&t.push(new W(i,d,m,u,a))}n.push(o)}for(;o=n.pop();)e(o.node,o.x0,o.y0,o.x1,o.y1);return this}function bn(e){return e[0]}function Nn(e){return arguments.length?(this._x=e,this):this._x}function En(e){return e[1]}function In(e){return arguments.length?(this._y=e,this):this._y}function Oe(e,t,n){var o=new Be(t==null?bn:t,n==null?En:n,NaN,NaN,NaN,NaN);return e==null?o:o.addAll(e)}function Be(e,t,n,o,r,i){this._x=e,this._y=t,this._x0=n,this._y0=o,this._x1=r,this._y1=i,this._root=void 0}function Ge(e){for(var t={data:e.data},n=t;e=e.next;)n=n.next={data:e.data};return t}var U=Oe.prototype=Be.prototype;U.copy=function(){var e=new Be(this._x,this._y,this._x0,this._y0,this._x1,this._y1),t=this._root,n,o;if(!t)return e;if(!t.length)return e._root=Ge(t),e;for(n=[{source:t,target:e._root=new Array(4)}];t=n.pop();)for(var r=0;r<4;++r)(o=t.source[r])&&(o.length?n.push({source:o,target:t.target[r]=new Array(4)}):t.target[r]=Ge(o));return e};U.add=dn;U.addAll=cn;U.cover=pn;U.data=vn;U.extent=hn;U.find=gn;U.remove=wn;U.removeAll=mn;U.root=yn;U.size=kn;U.visit=_n;U.visitAfter=xn;U.x=Nn;U.y=In;function L(e){return function(){return e}}function Y(e){return(e()-.5)*1e-6}function Fn(e){return e.x+e.vx}function jn(e){return e.y+e.vy}function ct(e){var t,n,o,r=1,i=1;typeof e!="function"&&(e=L(e==null?1:+e));function s(){for(var a,d=t.length,m,w,h,b,c,f,p=0;p<i;++p)for(m=Oe(t,Fn,jn).visitAfter(l),a=0;a<d;++a)w=t[a],c=n[w.index],f=c*c,h=w.x+w.vx,b=w.y+w.vy,m.visit(g);function g(A,k,j,_,V){var F=A.data,B=A.r,S=c+B;if(F){if(F.index>w.index){var R=h-F.x-F.vx,Q=b-F.y-F.vy,z=R*R+Q*Q;z<S*S&&(R===0&&(R=Y(o),z+=R*R),Q===0&&(Q=Y(o),z+=Q*Q),z=(S-(z=Math.sqrt(z)))/z*r,w.vx+=(R*=z)*(S=(B*=B)/(f+B)),w.vy+=(Q*=z)*S,F.vx-=R*(S=1-S),F.vy-=Q*S)}return}return k>h+S||_<h-S||j>b+S||V<b-S}}function l(a){if(a.data)return a.r=n[a.data.index];for(var d=a.r=0;d<4;++d)a[d]&&a[d].r>a.r&&(a.r=a[d].r)}function u(){if(!!t){var a,d=t.length,m;for(n=new Array(d),a=0;a<d;++a)m=t[a],n[m.index]=+e(m,a,t)}}return s.initialize=function(a,d){t=a,o=d,u()},s.iterations=function(a){return arguments.length?(i=+a,s):i},s.strength=function(a){return arguments.length?(r=+a,s):r},s.radius=function(a){return arguments.length?(e=typeof a=="function"?a:L(+a),u(),s):e},s}function An(e){return e.index}function et(e,t){var n=e.get(t);if(!n)throw new Error("node not found: "+t);return n}function pt(e){var t=An,n=m,o,r=L(30),i,s,l,u,a,d=1;e==null&&(e=[]);function m(f){return 1/Math.min(l[f.source.index],l[f.target.index])}function w(f){for(var p=0,g=e.length;p<d;++p)for(var A=0,k,j,_,V,F,B,S;A<g;++A)k=e[A],j=k.source,_=k.target,V=_.x+_.vx-j.x-j.vx||Y(a),F=_.y+_.vy-j.y-j.vy||Y(a),B=Math.sqrt(V*V+F*F),B=(B-i[A])/B*f*o[A],V*=B,F*=B,_.vx-=V*(S=u[A]),_.vy-=F*S,j.vx+=V*(S=1-S),j.vy+=F*S}function h(){if(!!s){var f,p=s.length,g=e.length,A=new Map(s.map((j,_)=>[t(j,_,s),j])),k;for(f=0,l=new Array(p);f<g;++f)k=e[f],k.index=f,typeof k.source!="object"&&(k.source=et(A,k.source)),typeof k.target!="object"&&(k.target=et(A,k.target)),l[k.source.index]=(l[k.source.index]||0)+1,l[k.target.index]=(l[k.target.index]||0)+1;for(f=0,u=new Array(g);f<g;++f)k=e[f],u[f]=l[k.source.index]/(l[k.source.index]+l[k.target.index]);o=new Array(g),b(),i=new Array(g),c()}}function b(){if(!!s)for(var f=0,p=e.length;f<p;++f)o[f]=+n(e[f],f,e)}function c(){if(!!s)for(var f=0,p=e.length;f<p;++f)i[f]=+r(e[f],f,e)}return w.initialize=function(f,p){s=f,a=p,h()},w.links=function(f){return arguments.length?(e=f,h(),w):e},w.id=function(f){return arguments.length?(t=f,w):t},w.iterations=function(f){return arguments.length?(d=+f,w):d},w.strength=function(f){return arguments.length?(n=typeof f=="function"?f:L(+f),b(),w):n},w.distance=function(f){return arguments.length?(r=typeof f=="function"?f:L(+f),c(),w):r},w}var Cn={value:()=>{}};function vt(){for(var e=0,t=arguments.length,n={},o;e<t;++e){if(!(o=arguments[e]+"")||o in n||/[\s.]/.test(o))throw new Error("illegal type: "+o);n[o]=[]}return new ke(n)}function ke(e){this._=e}function Vn(e,t){return e.trim().split(/^|\s+/).map(function(n){var o="",r=n.indexOf(".");if(r>=0&&(o=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:o}})}ke.prototype=vt.prototype={constructor:ke,on:function(e,t){var n=this._,o=Vn(e+"",n),r,i=-1,s=o.length;if(arguments.length<2){for(;++i<s;)if((r=(e=o[i]).type)&&(r=Sn(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(r=(e=o[i]).type)n[r]=tt(n[r],e.name,t);else if(t==null)for(r in n)n[r]=tt(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new ke(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),o=0,r,i;o<r;++o)n[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],o=0,r=i.length;o<r;++o)i[o].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var o=this._[e],r=0,i=o.length;r<i;++r)o[r].value.apply(t,n)}};function Sn(e,t){for(var n=0,o=e.length,r;n<o;++n)if((r=e[n]).name===t)return r.value}function tt(e,t,n){for(var o=0,r=e.length;o<r;++o)if(e[o].name===t){e[o]=Cn,e=e.slice(0,o).concat(e.slice(o+1));break}return n!=null&&e.push({name:t,value:n}),e}var se=0,de=0,fe=0,ht=1e3,xe,ce,be=0,te=0,Ne=0,ge=typeof performance=="object"&&performance.now?performance:Date,gt=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function wt(){return te||(gt(On),te=ge.now()+Ne)}function On(){te=0}function Ve(){this._call=this._time=this._next=null}Ve.prototype=mt.prototype={constructor:Ve,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?wt():+n)+(t==null?0:+t),!this._next&&ce!==this&&(ce?ce._next=this:xe=this,ce=this),this._call=e,this._time=n,Se()},stop:function(){this._call&&(this._call=null,this._time=1/0,Se())}};function mt(e,t,n){var o=new Ve;return o.restart(e,t,n),o}function Bn(){wt(),++se;for(var e=xe,t;e;)(t=te-e._time)>=0&&e._call.call(void 0,t),e=e._next;--se}function nt(){te=(be=ge.now())+Ne,se=de=0;try{Bn()}finally{se=0,Tn(),te=0}}function Mn(){var e=ge.now(),t=e-be;t>ht&&(Ne-=t,be=e)}function Tn(){for(var e,t=xe,n,o=1/0;t;)t._call?(o>t._time&&(o=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:xe=n);ce=e,Se(o)}function Se(e){if(!se){de&&(de=clearTimeout(de));var t=e-te;t>24?(e<1/0&&(de=setTimeout(nt,e-ge.now()-Ne)),fe&&(fe=clearInterval(fe))):(fe||(be=ge.now(),fe=setInterval(Mn,ht)),se=1,gt(nt))}}const Dn=1664525,$n=1013904223,ot=4294967296;function Pn(){let e=1;return()=>(e=(Dn*e+$n)%ot)/ot}function Ln(e){return e.x}function Qn(e){return e.y}var Rn=10,zn=Math.PI*(3-Math.sqrt(5));function yt(e){var t,n=1,o=.001,r=1-Math.pow(o,1/300),i=0,s=.6,l=new Map,u=mt(m),a=vt("tick","end"),d=Pn();e==null&&(e=[]);function m(){w(),a.call("tick",t),n<o&&(u.stop(),a.call("end",t))}function w(c){var f,p=e.length,g;c===void 0&&(c=1);for(var A=0;A<c;++A)for(n+=(i-n)*r,l.forEach(function(k){k(n)}),f=0;f<p;++f)g=e[f],g.fx==null?g.x+=g.vx*=s:(g.x=g.fx,g.vx=0),g.fy==null?g.y+=g.vy*=s:(g.y=g.fy,g.vy=0);return t}function h(){for(var c=0,f=e.length,p;c<f;++c){if(p=e[c],p.index=c,p.fx!=null&&(p.x=p.fx),p.fy!=null&&(p.y=p.fy),isNaN(p.x)||isNaN(p.y)){var g=Rn*Math.sqrt(.5+c),A=c*zn;p.x=g*Math.cos(A),p.y=g*Math.sin(A)}(isNaN(p.vx)||isNaN(p.vy))&&(p.vx=p.vy=0)}}function b(c){return c.initialize&&c.initialize(e,d),c}return h(),t={tick:w,restart:function(){return u.restart(m),t},stop:function(){return u.stop(),t},nodes:function(c){return arguments.length?(e=c,h(),l.forEach(b),t):e},alpha:function(c){return arguments.length?(n=+c,t):n},alphaMin:function(c){return arguments.length?(o=+c,t):o},alphaDecay:function(c){return arguments.length?(r=+c,t):+r},alphaTarget:function(c){return arguments.length?(i=+c,t):i},velocityDecay:function(c){return arguments.length?(s=1-c,t):1-s},randomSource:function(c){return arguments.length?(d=c,l.forEach(b),t):d},force:function(c,f){return arguments.length>1?(f==null?l.delete(c):l.set(c,b(f)),t):l.get(c)},find:function(c,f,p){var g=0,A=e.length,k,j,_,V,F;for(p==null?p=1/0:p*=p,g=0;g<A;++g)V=e[g],k=c-V.x,j=f-V.y,_=k*k+j*j,_<p&&(F=V,p=_);return F},on:function(c,f){return arguments.length>1?(a.on(c,f),t):a.on(c)}}}function kt(){var e,t,n,o,r=L(-30),i,s=1,l=1/0,u=.81;function a(h){var b,c=e.length,f=Oe(e,Ln,Qn).visitAfter(m);for(o=h,b=0;b<c;++b)t=e[b],f.visit(w)}function d(){if(!!e){var h,b=e.length,c;for(i=new Array(b),h=0;h<b;++h)c=e[h],i[c.index]=+r(c,h,e)}}function m(h){var b=0,c,f,p=0,g,A,k;if(h.length){for(g=A=k=0;k<4;++k)(c=h[k])&&(f=Math.abs(c.value))&&(b+=c.value,p+=f,g+=f*c.x,A+=f*c.y);h.x=g/p,h.y=A/p}else{c=h,c.x=c.data.x,c.y=c.data.y;do b+=i[c.data.index];while(c=c.next)}h.value=b}function w(h,b,c,f){if(!h.value)return!0;var p=h.x-t.x,g=h.y-t.y,A=f-b,k=p*p+g*g;if(A*A/u<k)return k<l&&(p===0&&(p=Y(n),k+=p*p),g===0&&(g=Y(n),k+=g*g),k<s&&(k=Math.sqrt(s*k)),t.vx+=p*h.value*o/k,t.vy+=g*h.value*o/k),!0;if(h.length||k>=l)return;(h.data!==t||h.next)&&(p===0&&(p=Y(n),k+=p*p),g===0&&(g=Y(n),k+=g*g),k<s&&(k=Math.sqrt(s*k)));do h.data!==t&&(A=i[h.data.index]*o/k,t.vx+=p*A,t.vy+=g*A);while(h=h.next)}return a.initialize=function(h,b){e=h,n=b,d()},a.strength=function(h){return arguments.length?(r=typeof h=="function"?h:L(+h),d(),a):r},a.distanceMin=function(h){return arguments.length?(s=h*h,a):Math.sqrt(s)},a.distanceMax=function(h){return arguments.length?(l=h*h,a):Math.sqrt(l)},a.theta=function(h){return arguments.length?(u=h*h,a):Math.sqrt(u)},a}function Wn(e,t,n){var o,r=L(.1),i,s;typeof e!="function"&&(e=L(+e)),t==null&&(t=0),n==null&&(n=0);function l(a){for(var d=0,m=o.length;d<m;++d){var w=o[d],h=w.x-t||1e-6,b=w.y-n||1e-6,c=Math.sqrt(h*h+b*b),f=(s[d]-c)*i[d]*a/c;w.vx+=h*f,w.vy+=b*f}}function u(){if(!!o){var a,d=o.length;for(i=new Array(d),s=new Array(d),a=0;a<d;++a)s[a]=+e(o[a],a,o),i[a]=isNaN(s[a])?0:+r(o[a],a,o)}}return l.initialize=function(a){o=a,u()},l.strength=function(a){return arguments.length?(r=typeof a=="function"?a:L(+a),u(),l):r},l.radius=function(a){return arguments.length?(e=typeof a=="function"?a:L(+a),u(),l):e},l.x=function(a){return arguments.length?(t=+a,l):t},l.y=function(a){return arguments.length?(n=+a,l):n},l}function Un(e){var t=L(.1),n,o,r;typeof e!="function"&&(e=L(e==null?0:+e));function i(l){for(var u=0,a=n.length,d;u<a;++u)d=n[u],d.vx+=(r[u]-d.x)*o[u]*l}function s(){if(!!n){var l,u=n.length;for(o=new Array(u),r=new Array(u),l=0;l<u;++l)o[l]=isNaN(r[l]=+e(n[l],l,n))?0:+t(n[l],l,n)}}return i.initialize=function(l){n=l,s()},i.strength=function(l){return arguments.length?(t=typeof l=="function"?l:L(+l),s(),i):t},i.x=function(l){return arguments.length?(e=typeof l=="function"?l:L(+l),s(),i):e},i}function qn(e){var t=L(.1),n,o,r;typeof e!="function"&&(e=L(e==null?0:+e));function i(l){for(var u=0,a=n.length,d;u<a;++u)d=n[u],d.vy+=(r[u]-d.y)*o[u]*l}function s(){if(!!n){var l,u=n.length;for(o=new Array(u),r=new Array(u),l=0;l<u;++l)o[l]=isNaN(r[l]=+e(n[l],l,n))?0:+t(n[l],l,n)}}return i.initialize=function(l){n=l,s()},i.strength=function(l){return arguments.length?(t=typeof l=="function"?l:L(+l),s(),i):t},i.y=function(l){return arguments.length?(e=typeof l=="function"?l:L(+l),s(),i):e},i}var Jn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",forceCenter:ft,forceCollide:ct,forceLink:pt,forceManyBody:kt,forceRadial:Wn,forceSimulation:yt,forceX:Un,forceY:qn});class Kn{constructor(t={}){this.options=t}activate(t){const{layouts:n,nodes:o,edges:r,emitter:i,svgPanZoom:s}=t;let{nodeLayouts:l,nodeLayoutMap:u}=this.buildNodeLayouts(o.value,n,{x:0,y:0});const a=this.createSimulation(l,this.forceLayoutEdges(r.value));a.on("tick",()=>{var c,f;for(const p of l){const g=n==null?void 0:n[p.id];g&&(g.x=(c=p.x)!=null?c:0,g.y=(f=p.y)!=null?f:0)}});const d=()=>{a.alpha(.1).restart()},m=c=>{for(const[f,p]of Object.entries(c)){const g=u[f];g.fx=p.x,g.fy=p.y}d()},w=c=>{var f;for(const[p,g]of Object.entries(c)){const A=this.getNodeLayout(n,p),k=(f=u==null?void 0:u[p])!=null?f:{x:0,y:0};A.value.fixed||this.options.positionFixedByDrag?(k.fx=g.x,k.fy=g.y,A.value.fixed=!0):(k.x=g.x,k.y=g.y,delete k.fx,delete k.fy)}d()},h=({node:c,event:f})=>{if(this.options.positionFixedByClickWithAltKey&&f.altKey){const p=this.getNodeLayout(n,c);let g=u==null?void 0:u[c];g||(g={id:c,x:0,y:0},u[c]=g),p.value.fixed?(delete p.value.fixed,g.x=g.fx||g.x,g.y=g.fy||g.y,delete g.fx,delete g.fy):(p.value.fixed=!0,g.fx=g.x,g.fy=g.y),d()}},b=ee(()=>[Object.keys(o.value),r.value],()=>{const c=s.getViewArea();({nodeLayouts:l,nodeLayoutMap:u}=this.buildNodeLayouts(o.value,n,c.center)),a.nodes(l);const f=a.force("edge");f&&f.links(this.forceLayoutEdges(r.value)),d()},{deep:!0});i.on("node:dragstart",m),i.on("node:pointermove",m),i.on("node:dragend",w),i.on("node:click",h),this.onDeactivate=()=>{a.stop(),b(),i.off("node:dragstart",m),i.off("node:pointermove",m),i.off("node:dragend",w),i.off("node:click",h)}}deactivate(){this.onDeactivate&&this.onDeactivate()}createSimulation(t,n){if(this.options.createSimulation)return this.options.createSimulation(Jn,t,n);{const o=pt(n).id(r=>r.id);return yt(t).force("edge",o.distance(100)).force("charge",kt()).force("collide",ct(50).strength(.2)).force("center",ft().strength(.05)).alphaMin(.001)}}buildNodeLayouts(t,n,o){const r=Object.keys(t).filter(l=>!(l in n));for(const l of r)n[l]=je({},o);const i=this.forceNodeLayouts(n),s=Object.fromEntries(i.map(l=>[l.id,l]));return{nodeLayouts:i,nodeLayoutMap:s}}forceNodeLayouts(t){return Object.entries(t).map(([n,o])=>o.fixed?fn(je({id:n},o),{fx:o.x,fy:o.y}):je({id:n},o))}forceLayoutEdges(t){return Object.values(t).map(n=>({source:n.source,target:n.target}))}getNodeLayout(t,n){const o=Tt(t,n);return o.value||(o.value={x:0,y:0}),o}}const Hn=$(" No results "),Yn=ne({props:{modelValue:{type:Object,default:null},orgId:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,o=M({get(){return n.modelValue},set(u){t("update:modelValue",u)}}),r=T(""),i=we(),s=M(()=>i.state.Project.projects.filter(u=>u.title.indexOf(r.value)>=0||u.id.toString().indexOf(r.value)>=0)),l=(u,a,d)=>{const m=()=>r.value=u;s.value.length===0?i.dispatch("Project/fetchProjects",{orgId:n.orgId}).then(()=>a(m)):a(m)};return(u,a)=>(D(),P(N(st),{modelValue:N(o),"onUpdate:modelValue":a[0]||(a[0]=d=>rt(o)?o.value=d:null),label:"\u9879\u76EE\u5217\u8868","map-options":"","emit-value":"",behavior:"menu",options:N(s).map(d=>({label:d.title,value:d})),onFilter:l},{"no-option":E(()=>[x(H,null,{default:E(()=>[x(K,{class:"text-grey"},{default:E(()=>[Hn]),_:1})]),_:1})]),_:1},8,["modelValue","options"]))}}),Xn=ne({props:{modelValue:{type:Array,default:null},projectId:{type:Number,required:!0},workflowId:{type:Number,required:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const n=e,o=M({get(){return n.modelValue},set(u){t("update:modelValue",u)}}),r=T(""),i=we(),s=M(()=>{var u;return((u=i.state.WorkFlowTask.tasks.get(n.projectId))==null?void 0:u.filter(a=>(a.workflowId===0||a.workflowId===n.workflowId)&&(a.name.indexOf(r.value)>=0||a.id.indexOf(r.value)>=0)))||[]}),l=(u,a,d)=>{const m=()=>r.value=u;s.value.length===0?i.dispatch("WorkFlowTask/fetchTasks",{projectId:n.projectId}).then(()=>a(m)):a(m)};return ie(()=>{ee(()=>n.projectId,(u,a)=>{t("update:modelValue",void 0)})}),(u,a)=>(D(),P(N(st),{modelValue:N(o),"onUpdate:modelValue":a[0]||(a[0]=d=>rt(o)?o.value=d:null),label:"\u4EFB\u52A1\u5217\u8868","map-options":"","emit-value":"",behavior:"menu",multiple:"",disable:n.disabled,options:N(s).map(d=>({label:d.name,value:d})),onFilter:l},null,8,["modelValue","disable","options"]))}});function Ae(e){const t=Object.assign({},e);return t.deps&&(t.deps=Object.assign([],t.deps)),t}function Zn(e){const t=new Map,n=new Map;for(const l of e)if(t.set(l.id,l.deps||[]),l.deps)for(const u of l.deps){const a=n.get(u)||[];a.push(l.id),n.set(u,a)}let o=[];const r=new Map;t.forEach((l,u)=>{r.set(u,l.length),r.get(u)===0&&o.push(u)});const i=[];i.push(Object.assign([],o)),o=o.reverse();let s=[];for(;;){const l=o.pop();if(l===void 0){if(s.length===0)break;o=s.reverse(),i.push(Object.assign([],s)),s=[]}else{const u=n.get(l);if(!u)continue;for(const a of u){let d=r.get(a);d!==void 0&&(d--,r.set(a,d),d===0&&s.push(a))}}}return i}const Gn=he("div",{class:"text-h6"},"\u6DFB\u52A0\u65B0\u7684\u4EFB\u52A1\u8282\u70B9",-1),eo=$("\u6DFB\u52A0"),to=$("\u6DFB\u52A0"),no=$("\u91CD\u7F6E\u89C6\u56FE"),oo=$("\u91CD\u7F6E"),ro=ne({props:{workflowId:{type:Number,required:!0},tasks:{type:Object,required:!0},modelValue:{type:Object,default:new Array(0)},orgId:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{expose:t,emit:n}){const o=e,r=T(!1),i=T(!1),s=T(),l=T(),u=T([]),a=T([]),d=y=>k[y].name||y,m=y=>y.join(" -> "),w=y=>y.map(v=>k[v].name).join(" -> "),h=y=>{const v=y.split(" -> ");if(v.length!==2)throw new Error(`Invalid edge name: ${y}`);return[v[0],v[1]]},b="#99F6e4",c=new Kn,f=y=>y?y.color:b,p=y=>y?y.color:b,g={view:{layoutHandler:c,scalingObjects:!1,fit:!1},node:{selectable:!0,label:{direction:Dt.NORTH,color:f},normal:{color:f},hover:{color:f},focusring:{color:b}},edge:{selectable:!0,normal:{color:p},hover:{color:p},selected:{color:p,width:4,dasharray:"10",linecap:"round",animate:!0,animationSpeed:10},marker:{source:{type:"none",width:4,height:4,margin:-1,units:"strokeWidth",color:null},target:{type:"arrow",width:4,height:4,margin:-1,units:"strokeWidth",color:null}}}},A=M(()=>{const y=()=>{var I;(I=l.value)==null||I.hide()};return{"view:load":()=>{},"view:contextmenu":I=>{const{event:C}=I;C.stopPropagation(),C.preventDefault();const O=l.value;O&&(y(),O.show(C))},"node:select":I=>{y()},"edge:select":I=>{y()}}}),k=Ke({}),j=y=>{var I;const v=(I=y.state)==null?void 0:I.currentStatus;return v==="done"?b:v==="running"?"green":v==="failed"?"red":v==="starting"?"white":"gray"},_=M(()=>{const y={};for(const v of o.modelValue)y[v.id]={id:v.id,name:v.name,color:j(v)};return y}),V=M(()=>{const y=new Map;for(const v of o.modelValue)y.set(v.id,v);return y});function F(y){for(const v of Object.keys(k))delete k[v];for(const v of Object.keys(y))k[v]=Object.assign({},y[v]);u.value=[]}const B=Ke({}),S=M(()=>{const y={};for(const v of o.modelValue)if(!!v.deps)for(const I of v.deps)y[m([I,v.id])]={source:I,target:v.id,color:j(v)};return y});function R(y){for(const v of Object.keys(B))delete B[v];for(const v of Object.keys(y))B[v]=Object.assign({},y[v]);a.value=[]}const Q=T({nodes:{}}),z=M(()=>{const y={},v=Zn(o.modelValue),I=50,C=50;let O=0;for(const G of v){let ue=0;for(const At of G)y[At]={x:ue*I+O*I/2,y:O*C,fixed:!1},ue++;O++}return{nodes:y}});function Me(y){const v=Q.value.nodes;for(const I of Object.keys(v))delete v[I];for(const I of Object.keys(y.nodes))v[I]=Object.assign({},y.nodes[I])}function Te(){F(_.value),R(S.value),Me(z.value)}function _t(y,v){let I=0,C=!1;for(const O of y){if(O.id===v){y.splice(I,1),C=!0;break}I++}if(!C)throw new Error(`Can not remove node: ${v}`);for(const O of y)if(O.deps!==void 0){const G=O.deps.indexOf(v,0);G>-1&&(O.deps.splice(G,1),O.deps.length===0&&delete O.deps)}}function De(y){const v=o.modelValue.map(Ae);y.forEach(I=>_t(v,I)),n("update:modelValue",v)}function Ee(y,v){const I=o.modelValue.map(Ae);for(const C of I)if(C.id===v){C.deps||(C.deps=[]),C.deps.push(y),bt(),n("update:modelValue",I);return}throw new Error(`Can not add edge: ${m([y,v])}`)}function xt(y,v,I){for(const C of y)if(C.id===I&&C.deps!==void 0){const O=C.deps.indexOf(v,0);if(O>-1){C.deps.splice(O,1),C.deps.length===0&&delete C.deps;return}}throw new Error(`Can not remove edge: ${m([v,I])}`)}function $e(y){const v=o.modelValue.map(Ae);for(const I of y){const[C,O]=h(I);xt(v,C,O)}n("update:modelValue",v)}function bt(){a.value.splice(0,a.value.length),u.value.splice(0,u.value.length)}function Pe(){n("update:modelValue",o.tasks)}const Le=(y,v)=>B[m([y,v])]===void 0&&B[m([v,y])]===void 0,Nt=M(()=>{const y=u.value;if(y.length===2){const[v,I]=y;return Le(v,I)}return!1}),me=T(!1),X=T(),Z=T([]);function Qe(){me.value=!0}function Re(){X.value=void 0,Z.value=[],me.value=!1}function Et(){const y=[];Z.value.forEach((v,I,C)=>{var O;y.push({name:v.name,id:`${(O=X.value)==null?void 0:O.id}_${v.id}`,origin:v})}),n("update:modelValue",[...o.modelValue,...y]),Re()}ie(()=>{ee(()=>o.tasks,(I,C)=>{r.value=!1,i.value=!1,v.value=void 0,Pe()}),ee(()=>o.modelValue,I=>{F(_.value),R(S.value),JSON.stringify(I)===JSON.stringify(o.tasks)&&Me(z.value),r.value=!0});function y(I,C){try{for(const O of Object.keys(I)){const G=I[O],ue=C[O];if(Math.abs(G.x-ue.x)>.5||Math.abs(G.y-ue.y)>.5)return!1}}catch{return!1}return!0}const v=T();ee(()=>[Q.value,s.value,r.value],([I,C,O])=>{!i.value&&C&&O&&y(I.nodes,v.value)&&setTimeout(()=>{Ce(()=>{C.panToCenter(),i.value=!0})},500),v.value=JSON.parse(JSON.stringify(Lt(Q.value.nodes)))},{deep:!0})});function It(){De(u.value)}function Ft(){$e(a.value)}function jt(){const[y]=u.value,v=_e(()=>{if(u.value.length!==1)return;const[I]=u.value;y===I||!Le(y,I)||(Ee(y,I),v())})}return t({ShowAddNodeDialog:Qe,RemoveSelectedNodes:It,SelectedNodes:u,RemoveSelectedEdges:Ft,SelectedEdges:a,ResetView:Te,AddEdge:Ee,SetAddEdgeMode:jt,NodeMapTask:V}),(y,v)=>{const I=Qt("v-network-graph");return D(),ve(Pt,null,[r.value?(D(),P(I,{key:0,ref_key:"graph",ref:s,"selected-nodes":u.value,"onUpdate:selected-nodes":v[0]||(v[0]=C=>u.value=C),"selected-edges":a.value,"onUpdate:selected-edges":v[1]||(v[1]=C=>a.value=C),layouts:Q.value,"onUpdate:layouts":v[2]||(v[2]=C=>Q.value=C),class:$t(i.value?"":"tw-opacity-0"),nodes:N(k),edges:N(B),configs:g,"zoom-level":.75,"event-handlers":N(A)},null,8,["selected-nodes","selected-edges","layouts","class","nodes","edges","zoom-level","event-handlers"])):J("",!0),x(Yt,{modelValue:me.value,"onUpdate:modelValue":v[5]||(v[5]=C=>me.value=C),class:"tw-w-screen tw-h-screen",onHide:Re},{default:E(()=>[x(it,{class:"tw-w-96 q-pa-sm"},{default:E(()=>[x(le,null,{default:E(()=>[Gn]),_:1}),x(le,null,{default:E(()=>[x(Yn,{modelValue:X.value,"onUpdate:modelValue":v[3]||(v[3]=C=>X.value=C),"org-id":e.orgId},null,8,["modelValue","org-id"]),x(Xn,{modelValue:Z.value,"onUpdate:modelValue":v[4]||(v[4]=C=>Z.value=C),disabled:X.value===void 0,"project-id":X.value?X.value.id:0,"workflow-id":o.workflowId},null,8,["modelValue","disabled","project-id","workflow-id"])]),_:1}),x(Xt,{align:"around"},{default:E(()=>[x(q,{class:"tw-w-full tw-mx-2 tw-my-3",color:Z.value?"primary":"","text-color":Z.value?"black":"white",disable:!Z.value,onClick:Et},{default:E(()=>[eo]),_:1},8,["color","text-color","disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),x(N(Zt),{ref_key:"viewMenu",ref:l,"touch-position":"","context-menu":""},{default:E(()=>[x(Gt,{dense:""},{default:E(()=>[re((D(),P(H,{key:"add-task",clickable:"",onClick:Qe},{default:E(()=>[x(K,null,{default:E(()=>[to]),_:1})]),_:1})),[[ae]]),N(Nt)?re((D(),P(H,{key:"add-edge",clickable:"",onClick:v[6]||(v[6]=()=>Ee(u.value[0],u.value[1]))},{default:E(()=>[x(K,null,{default:E(()=>[$("\u6DFB\u52A0\u6307\u5411\uFF1A"+pe(w(u.value)),1)]),_:1})]),_:1})),[[ae]]):J("",!0),a.value.length>0?re((D(),P(H,{key:"remove-edge",clickable:"",onClick:v[7]||(v[7]=()=>$e(a.value))},{default:E(()=>[x(K,null,{default:E(()=>[$(" \u5220\u9664\u6307\u5411\uFF1A"+pe(a.value.map(h).map(w).join(", ")),1)]),_:1})]),_:1})),[[ae]]):J("",!0),u.value.length>0?re((D(),P(H,{key:"remove-task",clickable:"",onClick:v[8]||(v[8]=()=>De(u.value))},{default:E(()=>[x(K,null,{default:E(()=>[$(" \u5220\u9664\u8282\u70B9\uFF1A"+pe(u.value.map(d).join(", ")),1)]),_:1})]),_:1})),[[ae]]):J("",!0),x(ut),re((D(),P(H,{key:"reset-view",clickable:"",onClick:Te},{default:E(()=>[x(K,null,{default:E(()=>[no]),_:1})]),_:1})),[[ae]]),re((D(),P(H,{key:"reset",clickable:"",onClick:Pe},{default:E(()=>[x(K,null,{default:E(()=>[oo]),_:1})]),_:1})),[[ae]])]),_:1})]),_:1},512)],64)}}}),ao={class:"tw-w-full tw-h-full tw-flex tw-flex-col"},lo={class:"tw-flex tw-flex-row tw-gap-4 tw-flex-wrap tw-grow-0"},io=$(" \u8FD0\u884C "),so=$(" Kill "),uo=$(" \u4FDD\u5B58 "),fo=$(" \u5237\u65B0 "),co=$(" \u91CD\u7F6E\u89C6\u56FE "),po=$(" \u6DFB\u52A0\u65B0\u4EFB\u52A1\u8282\u70B9 "),vo=$(" \u5173\u8054\u8282\u70B9 "),ho=$(" \u5220\u9664\u8282\u70B9\uFF08\u5173\u7CFB\uFF09 "),go=$(" \u4EFB\u52A1\u8BE6\u60C5 "),wo=$(" \u4EFB\u52A1\u65E5\u5FD7 "),mo={class:"tw-grow tw-w-full tw-overflow-hidden"},yo=ne({props:{id:{type:Number,required:!0},orgId:{type:String,required:!0}},setup(e){const t=e,{width:n}=lt(),o=M(()=>n.value<1024),r=T(),i=M(()=>r.value===void 0||r.value.SelectedNodes.length===0&&r.value.SelectedEdges.length===0),s=M(()=>{if(!r.value||r.value.SelectedNodes.length!==1)return;const j=r.value.SelectedNodes;return r.value.NodeMapTask.get(j[j.length-1])}),l=T([]),u=T([]),a=we(),d=T(!1),m=T(!1),w=T();async function h(){w.value=await Wt(t.id)}const b=M(()=>w.value!==void 0&&w.value.state!==null&&w.value.state.status==="running");async function c(j){const _=new Map,V=new Map;for(const F of j){const S=a.state.Root.workflowTasks.find(Q=>Q.id===F.taskId);if(S===void 0)throw new Error(`workflowTasks missing projectId=${F.projectId} taskId=${F.taskId}`);const R=`${F.projectId}_${F.taskId}`;if(V.set(R,S),_.has(R)||_.set(R,[]),F.dependencyProjectId>0&&F.dependencyTaskId!==""){const Q=`${F.dependencyProjectId}_${F.dependencyTaskId}`,z=_.get(R);z!==void 0&&_.set(R,[...z,Q])}}return Array.from(_.keys()).map(F=>{const B=V.get(F);if(B===void 0)throw new Error(`keyMapTask missing ${F}`);return{name:B.name,id:F,deps:_.get(F),origin:B,state:a.state.Root.workflowTaskStates.find(S=>S.projectId===B.projectId&&S.taskId===B.id)}})}function f(j){const _=[],V=new Map;for(const F of j)V.set(F.id,F.origin);for(const F of j)if(F.deps!==void 0&&F.deps.length>0)for(const B of F.deps){const S=V.get(B);if(S===void 0)throw new Error("original task object missing");_.push({id:0,workflowId:0,createTime:0,projectId:F.origin.projectId,taskId:F.origin.id,dependencyProjectId:S.projectId,dependencyTaskId:S.id})}else _.push({id:0,workflowId:0,createTime:0,projectId:F.origin.projectId,taskId:F.origin.id,dependencyProjectId:0,dependencyTaskId:""});return _}async function p(j=!1){await a.dispatch("fetchWorkflowEdges",{workflowId:t.id});const _=await c(a.state.Root.workflowEdges);j?u.value=_:l.value=_}ie(()=>{console.log("subscribe"),a.dispatch("subscribeTopic",["/workflow/status/"+t.id,"/workflow/task/status/"+t.id]),h(),p(),ee(()=>t.id,async j=>{console.log("subscribe"),a.dispatch("subscribeTopic",["/workflow/status/"+t.id,"/workflow/task/status/"+t.id]),await h(),await p()}),a.watch(j=>[j.Root.eventWorkFlowTask,j.Root.eventWorkFlow],async([j,_])=>{(j===void 0||j.workFlowId!==t.id)&&(_===void 0||_.workFlowId!==t.id)||(await h(),await p(!0))})});const g=M(()=>{const j=_=>_.map(V=>qe(Ue({},V),{origin:void 0,state:void 0}));return JSON.stringify(j(l.value))!==JSON.stringify(j(u.value))}),A=T(!1);async function k(){A.value=!0,await a.dispatch("updateWorkFlowEdges",{workflowId:t.id,edges:f(u.value)}),await p(),A.value=!1}return(j,_)=>(D(),ve("div",ao,[x(He,{modelValue:d.value,"onUpdate:modelValue":_[0]||(_[0]=V=>d.value=V),content:"\u786E\u5B9A\u8981\u7ACB\u5373\u6267\u884C\u5417\uFF1F",onConfirm:_[1]||(_[1]=()=>N(Rt)(N(a).getters.apiv1,t.id).then(()=>{d.value=!1,p()}))},null,8,["modelValue"]),x(He,{modelValue:m.value,"onUpdate:modelValue":_[2]||(_[2]=V=>m.value=V),type:"warning",content:"\u786E\u5B9A\u8981\u505C\u6B62\u6267\u884C\u5417\uFF1F",onConfirm:_[3]||(_[3]=()=>N(zt)(t.id).then(()=>{m.value=!1,p()}))},null,8,["modelValue"]),he("div",lo,[N(b)?(D(),P(q,{key:1,dense:N(o),color:"red",onClick:_[5]||(_[5]=V=>m.value=!0)},{default:E(()=>[so]),_:1},8,["dense"])):(D(),P(q,{key:0,dense:N(o),color:"primary","text-color":"black",loading:N(b),onClick:_[4]||(_[4]=V=>d.value=!0)},{default:E(()=>[io]),_:1},8,["dense","loading"])),x(q,{dense:N(o),color:N(g)?"primary":"","text-color":N(g)?"black":"white",disable:!N(g),loading:A.value,onClick:k},{default:E(()=>[uo]),_:1},8,["dense","color","text-color","disable","loading"]),x(q,{dense:N(o),flat:"",icon:"refresh",title:"\u5237\u65B0",onClick:_[6]||(_[6]=()=>p())},{default:E(()=>[fo]),_:1},8,["dense"]),x(q,{dense:N(o),flat:"",icon:"restart_alt",title:"\u91CD\u7F6E\u89C6\u56FE",onClick:_[7]||(_[7]=()=>r.value.ResetView())},{default:E(()=>[co]),_:1},8,["dense"]),x(q,{dense:N(o),flat:"",icon:"add",title:"\u6DFB\u52A0\u65B0\u4EFB\u52A1\u8282\u70B9",onClick:_[8]||(_[8]=()=>r.value.ShowAddNodeDialog())},{default:E(()=>[po]),_:1},8,["dense"]),N(s)!==void 0?(D(),P(q,{key:"create_relationship",dense:N(o),flat:"",icon:"north_east",title:"\u5173\u8054\u8282\u70B9",disable:!r.value||r.value.SelectedNodes.length!==1,onClick:_[9]||(_[9]=()=>{r.value.SetAddEdgeMode(),N(a).getters.$q.notify({type:"info",message:"\u8BF7\u9009\u62E9\u6709\u6548\u7684\u4E0B\u6E38\u8282\u70B9",icon:"tips_and_updates",position:"top-right"})})},{default:E(()=>[vo]),_:1},8,["dense","disable"])):J("",!0),N(s)!==void 0?(D(),P(q,{key:"delete_task_or_relationship",dense:N(o),icon:"delete",disable:N(i),title:"\u5220\u9664\u5DF2\u9009\u7684\u8282\u70B9\u53CA\u8282\u70B9\u5173\u8054\u5173\u7CFB",flat:"",onClick:_[10]||(_[10]=()=>{r.value.SelectedNodes.length>0&&r.value.RemoveSelectedNodes(),r.value.SelectedEdges.length>0&&r.value.RemoveSelectedEdges()})},{default:E(()=>[ho]),_:1},8,["dense","disable"])):J("",!0),N(s)!==void 0?(D(),P(q,{key:"jump_task_detail",dense:N(o),icon:"task_alt",flat:"",to:{name:"workflow_task",params:{projectId:N(s).origin.projectId,taskId:N(s).origin.id}}},{default:E(()=>[go]),_:1},8,["dense","to"])):J("",!0),N(s)!==void 0?(D(),P(q,{key:"jump_task_logs",dense:N(o),icon:"view_timeline",flat:"",to:{name:"workflow_task_logs",params:{projectId:N(s).origin.projectId,taskId:N(s).origin.id}}},{default:E(()=>[wo]),_:1},8,["dense","to"])):J("",!0)]),he("div",mo,[x(ro,{ref_key:"workflow",ref:r,modelValue:u.value,"onUpdate:modelValue":_[11]||(_[11]=V=>u.value=V),"org-id":e.orgId,"workflow-id":t.id,tasks:l.value},null,8,["modelValue","org-id","workflow-id","tasks"])])]))}}),ko={key:0,class:"text-h6"},_o={key:1,class:"text-h6"},xo=ne({props:{id:{type:Number,default:0}},setup(e){const t=e,n=M(()=>({id:0,title:"",oid:"",cronExpr:"0 0 0 * * * *",remark:"",createTime:0,status:Ut,state:null})),o=qt(),r=we(),i=M(()=>r.state.WorkFlow.workflows.get(t.id)),s=T(Object.assign({},i.value||n.value));function l(){s.value=Object.assign({},i.value||n.value)}_e(()=>{s.value=Object.assign({},i.value||n.value)});const u=T(!1);async function a(){u.value=!0;try{const c=s.value;m.value?(await Jt(r.getters.apiv1,r.getters.currentOrg,c.title.trim(),c.remark.trim(),c.cronExpr.trim(),c.status),o.push({name:"workflows"})):(await Kt(r.getters.apiv1,s.value),r.commit("success",{message:"\u66F4\u65B0\u6210\u529F"}),await w())}catch(c){console.error(c),r.commit("error",{error:c})}u.value=!1}const d=at(),m=M(()=>d.name&&d.name.toString()==="create_workflow");async function w(){m.value||r.dispatch("WorkFlow/fetchWorkFlow",{id:t.id})}const h=M(()=>JSON.stringify(i.value)!==JSON.stringify(s.value)),b=M(()=>{const{title:c,cronExpr:f}=s.value;return c.trim()!==""&&f.trim()!==""});return ie(()=>{w(),ee(()=>t.id,async c=>{await w()})}),(c,f)=>(D(),P(en,{onSubmit:a,onReset:l},{default:E(()=>[x(le,null,{default:E(()=>[N(m)?(D(),ve("div",ko,"\u521B\u5EFA\u4EFB\u52A1\u7F16\u6392")):(D(),ve("div",_o,"\u4EFB\u52A1\u7F16\u6392\u8BE6\u60C5"))]),_:1}),x(le,null,{default:E(()=>[x(Fe,{modelValue:s.value.title,"onUpdate:modelValue":f[0]||(f[0]=p=>s.value.title=p),type:"text",label:"\u540D\u79F0",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),x(Fe,{key:"cron",modelValue:s.value.cronExpr,"onUpdate:modelValue":f[1]||(f[1]=p=>s.value.cronExpr=p),label:"\u8C03\u5EA6\u8BA1\u5212 (*\u79D2 *\u5206 *\u65F6 *\u65E5 *\u6708 *\u5468 *\u5E74)",square:"",filled:"",class:"tw-mb-4"},null,8,["modelValue"]),x(Fe,{modelValue:s.value.remark,"onUpdate:modelValue":f[2]||(f[2]=p=>s.value.remark=p),type:"textarea",label:"\u5907\u6CE8",square:"",filled:""},null,8,["modelValue"]),x(Ht,{key:"status",modelValue:s.value.status,"onUpdate:modelValue":f[3]||(f[3]=p=>s.value.status=p),"false-value":2,"true-value":1,label:"\u662F\u5426\u542F\u7528",class:"tw-mb-4"},null,8,["modelValue"])]),_:1}),x(le,{align:"right",class:"tw-flex tw-gap-4 tw-flex-col-reverse lg:tw-flex-row lg:tw-justify-end"},{default:E(()=>[x(q,{type:"reset",flat:"",label:"\u91CD\u7F6E",class:"lg:tw-w-24 tw-w-full",disable:!N(h)},null,8,["disable"]),x(q,{color:"primary","text-color":"black",type:"submit",label:N(m)?"\u521B\u5EFA":"\u4FDD\u5B58",disable:!N(h)||!N(b),loading:u.value,class:"lg:tw-w-24 tw-w-full"},null,8,["label","disable","loading"])]),_:1})]),_:1}))}}),bo=$("\u5F00\u59CB\u65F6\u95F4"),No=$("\u7ED3\u675F\u65F6\u95F4"),Eo=ne({props:{id:{type:Number,required:!0}},setup(e){const t=e,n=we(),o=M(()=>n.state.Root.workflowLogs),r=M(()=>n.state.Root.workflowLogsTotal),i=M(()=>n.state.Root.loadingWorkflowLogs),s=T({sortBy:"",descending:!1,page:1,rowsPerPage:5,rowsNumber:0}),l=T();ie(()=>{Ce(()=>{var d;(d=l.value)==null||d.$el.querySelector("table.q-table").classList.add("tw-table-fixed")})});const u=()=>{Ce(()=>{var m;const d=(m=l.value)==null?void 0:m.$el.querySelector(".scroll");d==null||d.scrollTo({top:0})})};function a({pagination:{page:d,rowsPerPage:m}}){const w=s.value;w.page=d,w.rowsPerPage=m,u()}return _e(()=>{const d=s.value;d.rowsNumber=r.value}),ie(async()=>{_e(async()=>{const d=s.value;await n.dispatch("fetchWorkFlowLogs",{workflowId:t.id,page:d.page,pageSize:d.rowsPerPage})})}),(d,m)=>(D(),P(N(on),{ref_key:"table",ref:l,pagination:s.value,"onUpdate:pagination":m[0]||(m[0]=w=>s.value=w),class:"tw-w-full tw-h-full tw-bg-[#121212]","rows-per-page-options":[5,10,15],title:"\u6267\u884C\u65E5\u5FD7",rows:N(o),loading:N(i),"row-key":"id",color:"primary",flat:"","hide-header":"",onRequest:a},{loading:E(()=>[x(tn,{showing:"",color:"primary"})]),body:E(w=>[x(it,{class:"tw-my-4 tw-mx-4",flat:"",bordered:""},{default:E(()=>[x(H,null,{default:E(()=>[x(K,null,{default:E(()=>[x(ye,{overline:""},{default:E(()=>[bo]),_:1}),x(ye,null,{default:E(()=>[$(pe(N(Ye)(w.row.startTime*1e3)),1)]),_:2},1024)]),_:2},1024),x(K,null,{default:E(()=>[x(ye,{overline:""},{default:E(()=>[No]),_:1}),x(ye,null,{default:E(()=>[$(pe(N(Ye)(w.row.endTime*1e3)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),x(ut),x(le,{class:"tw-w-full tw-overflow-x-auto"},{default:E(()=>[x(nn,{json:w.row.result},null,8,["json"])]),_:2},1024)]),_:2},1024)]),_:1},8,["pagination","rows","loading"]))}}),Io={class:"lg:tw-px-4 lg:tw-pt-2 tw-w-full tw-h-full tw-flex tw-flex-col tw-box-border"},Fo={class:"tw-flex tw-h-full tw-w-full tw-overflow-hidden"},jo={class:"tw-hidden lg:tw-block"},Yo=ne({props:{id:{type:Number,default:0},orgId:{type:String,required:!0}},setup(e){const t=e,{width:n}=lt(),o=at(),r=M(()=>o.name&&o.name.toString()==="create_workflow"),i=M(()=>{var s;if(r.value)return"detail";if(o.name){const l=o.name.toString();if(l==="workflow_logs")return"logs";if(l==="workflow_graph")return"graph";if(l==="workflow_detail")return"detail"}throw new Error(`Unknown route name ${(s=o.name)==null?void 0:s.toString()}`)});return(s,l)=>(D(),ve("div",Io,[N(r)?J("",!0):(D(),P(Je,{key:0,"model-value":N(i),"active-color":"primary",align:"left",class:"lg:tw-hidden tw-display"},{default:E(()=>[x(oe,{name:"graph",label:"\u6D41\u7A0B",to:{name:"workflow_graph",params:{workflowId:t.id}},replace:""},null,8,["to"]),x(oe,{name:"logs",label:"\u65E5\u5FD7",to:{name:"workflow_logs",params:{workflowId:t.id}},replace:""},null,8,["to"]),x(oe,{name:"detail",label:"\u8BE6\u60C5",to:{name:"workflow_detail",params:{workflowId:t.id}},replace:""},null,8,["to"])]),_:1},8,["model-value"])),he("div",Fo,[x(Mt,{"model-value":N(i),animated:"",vertical:N(n)>=1024,class:"tw-w-full tw-h-full tw-bg-[#121212] tw-p-0 lg:tw-pr-4 tw-box-border"},{default:E(()=>[x(Ie,{name:"graph"},{default:E(()=>[x(yo,{id:t.id,"org-id":e.orgId},null,8,["id","org-id"])]),_:1}),x(Ie,{name:"logs"},{default:E(()=>[x(Eo,{id:t.id},null,8,["id"])]),_:1}),x(Ie,{name:"detail"},{default:E(()=>[x(xo,{id:t.id},null,8,["id"])]),_:1})]),_:1},8,["model-value","vertical"]),he("div",jo,[N(r)?J("",!0):(D(),P(Je,{key:0,"model-value":N(i),"active-color":"primary",vertical:"","switch-indicator":"",align:"left"},{default:E(()=>[x(oe,{name:"graph",label:"\u6D41\u7A0B",to:{name:"workflow_graph",params:{workflowId:t.id}},replace:""},null,8,["to"]),x(oe,{name:"logs",label:"\u65E5\u5FD7",to:{name:"workflow_logs",params:{workflowId:t.id}},replace:""},null,8,["to"]),x(oe,{name:"detail",label:"\u8BE6\u60C5",to:{name:"workflow_detail",params:{workflowId:t.id}},replace:""},null,8,["to"])]),_:1},8,["model-value"]))])])]))}});export{Yo as default};
